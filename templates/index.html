<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Research Agent</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                        <path d="M11 8v6"/>
                        <path d="M8 11h6"/>
                    </svg>
                </div>
                <h1>AI Research Agent</h1>
            </div>
            {% if demo_mode %}
            <span class="demo-badge">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="16" x2="12" y2="12"/>
                    <line x1="12" y1="8" x2="12.01" y2="8"/>
                </svg>
                Demo Mode
            </span>
            {% else %}
            <span class="live-badge">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                </svg>
                AI Enabled
            </span>
            {% endif %}
        </header>

        <!-- Main Content -->
        <main class="main">
            <!-- Research Input -->
            <section class="research-input">
                <div class="input-container">
                    <textarea id="query" placeholder="What would you like to research? Ask any question..."></textarea>
                    <div class="input-controls">
                        <div class="depth-selector">
                            <label>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                    <path d="M2 17l10 5 10-5"/>
                                    <path d="M2 12l10 5 10-5"/>
                                </svg>
                                Research Depth:
                            </label>
                            <select id="depth">
                                <option value="quick">Quick (3 sources)</option>
                                <option value="standard" selected>Standard (5 sources)</option>
                                <option value="deep">Deep (8 sources)</option>
                            </select>
                        </div>
                        <button id="btn-research" class="btn-primary">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                            <span class="btn-text">Start Research</span>
                            <span class="btn-loading" style="display: none;">Researching...</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Research Status -->
            <section id="research-status" class="research-status" style="display: none;">
                <div class="status-header">
                    <h2>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        Research in Progress
                    </h2>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                </div>
                <div class="status-steps">
                    <div class="step" id="step-plan">
                        <span class="step-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                            </svg>
                        </span>
                        <span class="step-text">Creating research plan...</span>
                    </div>
                    <div class="step" id="step-search">
                        <span class="step-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                        </span>
                        <span class="step-text">Searching sources...</span>
                    </div>
                    <div class="step" id="step-analyze">
                        <span class="step-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                            </svg>
                        </span>
                        <span class="step-text">Analyzing findings...</span>
                    </div>
                    <div class="step" id="step-synthesize">
                        <span class="step-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </span>
                        <span class="step-text">Synthesizing report...</span>
                    </div>
                </div>
            </section>

            <!-- Results -->
            <section id="results" class="results" style="display: none;">
                <!-- Research Plan -->
                <div class="result-section plan-section">
                    <div class="section-header">
                        <h3>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                            </svg>
                            Research Plan
                        </h3>
                        <button class="btn-toggle" data-target="plan-content">▼</button>
                    </div>
                    <div id="plan-content" class="section-content">
                        <div id="plan-objective" class="objective"></div>
                        <div id="plan-questions" class="questions"></div>
                    </div>
                </div>

                <!-- Key Findings -->
                <div class="result-section findings-section">
                    <div class="section-header">
                        <h3>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 18h6"/>
                                <path d="M10 22h4"/>
                                <path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"/>
                            </svg>
                            Key Findings
                        </h3>
                        <span id="findings-count" class="badge"></span>
                    </div>
                    <div id="findings-content" class="section-content findings-grid"></div>
                </div>

                <!-- Full Report -->
                <div class="result-section report-section">
                    <div class="section-header">
                        <h3>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="20" x2="18" y2="10"/>
                                <line x1="12" y1="20" x2="12" y2="4"/>
                                <line x1="6" y1="20" x2="6" y2="14"/>
                            </svg>
                            Research Report
                        </h3>
                    </div>
                    <div id="report-content" class="section-content">
                        <div id="report-summary" class="report-summary"></div>
                        <div id="report-insights" class="report-insights"></div>
                        <div id="report-conclusions" class="report-conclusions"></div>
                        <div id="report-limitations" class="report-limitations"></div>
                        <div id="report-recommendations" class="report-recommendations"></div>
                    </div>
                </div>

                <!-- Meta Info -->
                <div class="result-meta">
                    <span id="meta-sources">Sources: 0</span>
                    <span id="meta-time">Completed: --</span>
                    <span id="meta-id">ID: --</span>
                </div>
            </section>

            <!-- Example Queries -->
            <section class="examples">
                <h3>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                    </svg>
                    Try these research questions:
                </h3>
                <div class="example-grid">
                    <button class="example-btn" data-query="What are the latest trends in AI and machine learning for business?">AI in Business</button>
                    <button class="example-btn" data-query="How is remote work changing company culture and productivity?">Remote Work Impact</button>
                    <button class="example-btn" data-query="What are the most promising renewable energy technologies?">Renewable Energy</button>
                    <button class="example-btn" data-query="How are companies using automation to improve efficiency?">Business Automation</button>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 16v-4"/>
                    <path d="M12 8h.01"/>
                </svg>
                Autonomous research powered by AI • Multiple source synthesis • Structured insights
            </p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const queryInput = document.getElementById('query');
        const depthSelect = document.getElementById('depth');
        const btnResearch = document.getElementById('btn-research');
        const statusSection = document.getElementById('research-status');
        const resultsSection = document.getElementById('results');
        const progressFill = document.getElementById('progress-fill');

        // Start research
        btnResearch.addEventListener('click', startResearch);

        // Example buttons
        document.querySelectorAll('.example-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                queryInput.value = btn.dataset.query;
                startResearch();
            });
        });

        // Toggle sections
        document.querySelectorAll('.btn-toggle').forEach(btn => {
            btn.addEventListener('click', () => {
                const target = document.getElementById(btn.dataset.target);
                target.classList.toggle('collapsed');
                btn.textContent = target.classList.contains('collapsed') ? '▶' : '▼';
            });
        });

        async function startResearch() {
            const query = queryInput.value.trim();
            if (!query) return;

            const depth = depthSelect.value;

            // Show status, hide results
            statusSection.style.display = 'block';
            resultsSection.style.display = 'none';

            // Update button state
            btnResearch.querySelector('.btn-text').style.display = 'none';
            btnResearch.querySelector('.btn-loading').style.display = 'inline';
            btnResearch.disabled = true;

            // Animate progress
            animateProgress();

            try {
                const response = await fetch('/api/research', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query, depth })
                });

                const data = await response.json();
                displayResults(data);
            } catch (error) {
                console.error('Research failed:', error);
                alert('Research failed. Please try again.');
            } finally {
                // Reset button
                btnResearch.querySelector('.btn-text').style.display = 'inline';
                btnResearch.querySelector('.btn-loading').style.display = 'none';
                btnResearch.disabled = false;
                statusSection.style.display = 'none';
            }
        }

        function animateProgress() {
            const steps = ['step-plan', 'step-search', 'step-analyze', 'step-synthesize'];
            let current = 0;

            const interval = setInterval(() => {
                if (current > 0) {
                    document.getElementById(steps[current - 1]).classList.add('complete');
                }
                if (current < steps.length) {
                    document.getElementById(steps[current]).classList.add('active');
                    progressFill.style.width = ((current + 1) / steps.length * 100) + '%';
                    current++;
                } else {
                    clearInterval(interval);
                }
            }, 800);
        }

        function displayResults(data) {
            resultsSection.style.display = 'block';

            // Research Plan
            document.getElementById('plan-objective').innerHTML = `
                <strong>Objective:</strong> ${data.plan.main_objective}
            `;
            document.getElementById('plan-questions').innerHTML = `
                <strong>Sub-questions:</strong>
                <ul>${data.plan.sub_questions.map(q => `<li>${q}</li>`).join('')}</ul>
            `;

            // Findings
            document.getElementById('findings-count').textContent = `${data.findings.length} findings`;
            document.getElementById('findings-content').innerHTML = data.findings.map(f => `
                <div class="finding-card">
                    <span class="confidence confidence-${f.confidence}">${f.confidence}</span>
                    <p>${f.finding}</p>
                </div>
            `).join('');

            // Report
            const report = data.report;
            document.getElementById('report-summary').innerHTML = `
                <h4>Executive Summary</h4>
                <p>${report.executive_summary}</p>
            `;

            document.getElementById('report-insights').innerHTML = `
                <h4>Key Insights</h4>
                <div class="insights-grid">
                    ${report.key_insights.map(i => `
                        <div class="insight-card">
                            <strong>${i.insight}</strong>
                            <p>${i.explanation}</p>
                        </div>
                    `).join('')}
                </div>
            `;

            document.getElementById('report-conclusions').innerHTML = `
                <h4>Conclusions</h4>
                <ul>${report.conclusions.map(c => `<li>${c}</li>`).join('')}</ul>
            `;

            document.getElementById('report-limitations').innerHTML = `
                <h4>Limitations</h4>
                <ul>${report.limitations.map(l => `<li>${l}</li>`).join('')}</ul>
            `;

            document.getElementById('report-recommendations').innerHTML = `
                <h4>Recommendations</h4>
                <ul>${report.recommendations.map(r => `<li>${r}</li>`).join('')}</ul>
            `;

            // Meta
            document.getElementById('meta-sources').textContent = `Sources: ${data.sources_searched}`;
            document.getElementById('meta-time').textContent = `Completed: ${new Date(data.timestamp).toLocaleTimeString()}`;
            document.getElementById('meta-id').textContent = `ID: ${data.id}`;
        }
    </script>
</body>
</html>
